{"ast":null,"code":"import _slicedToArray from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{List}from'antd-mobile';import{getUserName,getAllUserInfos}from'../Utils/global';import styles from'./index.module.css';import{Image}from'antd-mobile';import{List as VirtualizedList,AutoSizer}from'react-virtualized';import HeadNav from'../Component/HeadNav';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var sortedMessageByTime=function sortedMessageByTime(){var messagesObj=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(messagesObj=={})return{};var lastmessageList=Object.keys(messagesObj).map(function(key){return[key,messagesObj[key].pop()];});lastmessageList.sort(function(a,b){return a[1].time<b[1].time?1:-1;});console.log(\"lastmessageList: \",lastmessageList);return lastmessageList;};export default function Message(){var navigate=useNavigate();var _useState=useState({}),_useState2=_slicedToArray(_useState,2),messageObjs=_useState2[0],setMessagesObjs=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),allUserInfos=_useState4[0],setallUserInfos=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),sortedLastMessageList=_useState6[0],setSortedLastMessageList=_useState6[1];useEffect(function(){var tmpallUserInfos=getAllUserInfos();var username=getUserName();setMessagesObjs(tmpallUserInfos[username].messageInfos);setSortedLastMessageList(sortedMessageByTime(tmpallUserInfos[username].messageInfos));setallUserInfos(tmpallUserInfos);},[]);console.log('messageObjs: ',messageObjs);console.log('sortedLastMessageList: ',sortedLastMessageList);if(sortedLastMessageList==[])return/*#__PURE__*/_jsx(HeadNav,{title:\"Messages\"});var rowRenderer=function rowRenderer(_ref){var index=_ref.index,key=_ref.key,style=_ref.style;var item=sortedLastMessageList[index];var curUserInfos=allUserInfos[item[0]];return/*#__PURE__*/_jsx(List.Item,{style:style,extra:item[1].time,onClick:function onClick(){navigate('/messagedetails',{replace:true,state:{'userId':item[0]}});},prefix:/*#__PURE__*/_jsx(Image,{src:curUserInfos.avatarUrl,style:{borderRadius:20},fit:\"cover\",width:60,height:60}),description:item[1].content,children:item[0]},key);};return/*#__PURE__*/_jsxs(\"div\",{className:styles.container,children:[/*#__PURE__*/_jsx(HeadNav,{title:\"Messages\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.body,children:/*#__PURE__*/_jsx(List,{children:/*#__PURE__*/_jsx(AutoSizer,{disableHeight:true,children:function children(_ref2){var width=_ref2.width;return/*#__PURE__*/_jsx(VirtualizedList,{rowCount:sortedLastMessageList.length,rowRenderer:rowRenderer,width:width,height:sortedLastMessageList.length*100,rowHeight:100,overscanRowCount:10});}})})})]});}","map":{"version":3,"names":["React","useEffect","useState","useNavigate","List","getUserName","getAllUserInfos","styles","Image","VirtualizedList","AutoSizer","HeadNav","sortedMessageByTime","messagesObj","lastmessageList","Object","keys","map","key","pop","sort","a","b","time","console","log","Message","navigate","messageObjs","setMessagesObjs","allUserInfos","setallUserInfos","sortedLastMessageList","setSortedLastMessageList","tmpallUserInfos","username","messageInfos","rowRenderer","index","style","item","curUserInfos","replace","state","avatarUrl","borderRadius","content","container","body","width","length"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/src/views/Message/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\n\nimport { List } from 'antd-mobile'\nimport { getUserName, getAllUserInfos } from '../Utils/global'\nimport styles from './index.module.css'\nimport { Image } from 'antd-mobile'\nimport { List as VirtualizedList, AutoSizer } from 'react-virtualized'\nimport HeadNav from '../Component/HeadNav'\n\nconst sortedMessageByTime = (messagesObj = {}) => {\n\n  if (messagesObj == {}) return {}\n  let lastmessageList = Object.keys(messagesObj).map((key) => [key, messagesObj[key].pop()])\n  lastmessageList.sort((a, b) => a[1].time < b[1].time ? 1 : -1)\n  console.log(\"lastmessageList: \", lastmessageList)\n  return lastmessageList\n}\n\nexport default function Message () {\n  const navigate = useNavigate()\n  const [messageObjs, setMessagesObjs] = useState({})\n  const [allUserInfos, setallUserInfos] = useState({})\n  const [sortedLastMessageList, setSortedLastMessageList] = useState([])\n  useEffect(() => {\n    let tmpallUserInfos = getAllUserInfos()\n    let username = getUserName()\n    setMessagesObjs(tmpallUserInfos[username].messageInfos)\n    setSortedLastMessageList(sortedMessageByTime(tmpallUserInfos[username].messageInfos))\n    setallUserInfos(tmpallUserInfos)\n\n\n  }, [])\n\n  console.log('messageObjs: ', messageObjs)\n  console.log('sortedLastMessageList: ', sortedLastMessageList)\n\n  if (sortedLastMessageList == []) return <HeadNav title='Messages' />\n\n  const rowRenderer = ({ index,\n    key,\n    style, }) => {\n\n    const item = sortedLastMessageList[index]\n    let curUserInfos = allUserInfos[item[0]]\n\n    return <List.Item\n      key={key}\n      style={style}\n      extra={item[1].time}\n      onClick={() => {\n        navigate('/messagedetails', { replace: true, state: { 'userId': item[0] } })\n      }}\n      prefix={\n        <Image\n          src={curUserInfos.avatarUrl}\n          style={{ borderRadius: 20 }}\n          fit='cover'\n          width={60}\n          height={60}\n        />\n\n      }\n      description={item[1].content}\n    >\n      {item[0]}\n    </List.Item>\n\n\n\n  }\n  return <div className={styles.container}>\n\n    <HeadNav title='Messages' />\n    <div className={styles.body}>\n      <List >\n        <AutoSizer disableHeight>\n          {({ width }) => (\n            <VirtualizedList\n              rowCount={sortedLastMessageList.length}\n              rowRenderer={rowRenderer}\n              width={width}\n              height={sortedLastMessageList.length * 100}\n              rowHeight={100}\n              overscanRowCount={10}\n            />\n          )}\n        </AutoSizer>\n      </List>\n\n    </div>\n\n  </div>\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}