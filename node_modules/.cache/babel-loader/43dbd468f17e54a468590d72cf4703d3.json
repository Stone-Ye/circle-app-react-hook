{"ast":null,"code":"import _slicedToArray from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{useLocation}from'react-router-dom';import styles from'./index.module.css';import{updateAllUserInfos,getUserName,getAllUserInfos}from'../Utils/global';import{AddCircleOutline,TravelOutline}from'antd-mobile-icons';import{List as VirtualizedList,AutoSizer}from'react-virtualized';import{Input,List}from'antd-mobile';import{getCurrentTimeFromYear2min}from'../Utils/time';import HeadNav from'../Component/HeadNav';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function MessageDetails(){var _useLocation=useLocation(),state=_useLocation.state;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messageLists=_useState2[0],setMessageLists=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),myAvatarUrl=_useState4[0],setmyAvatarUrl=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),otherAvatarUrl=_useState6[0],setotherAvatarUrl=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),userid=_useState8[0],setuserid=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),inputMessage=_useState10[0],setinputMessage=_useState10[1];console.log(\"state: \",state);useEffect(function(){if(state){var userId=state.userId;var allUserInfos=getAllUserInfos();var curusername=getUserName();if(userId in allUserInfos[curusername]['messageInfos']){var messagelist=allUserInfos[curusername]['messageInfos'][userId];setMessageLists(messagelist);}setuserid(userId);setmyAvatarUrl(allUserInfos[curusername].avatarUrl);setotherAvatarUrl(allUserInfos[userId].avatarUrl);// console.log(`userId:${userId}  messagelist:${messagelist}`)\n}},[state]);var rowRenderer=function rowRenderer(_ref){var index=_ref.index,key=_ref.key,style=_ref.style;var _messageLists$index=messageLists[index],obj=_messageLists$index.obj,time=_messageLists$index.time,content=_messageLists$index.content;return obj=='me'?/*#__PURE__*/_jsxs(\"div\",{className:styles.leftMessage,children:[/*#__PURE__*/_jsx(\"div\",{children:time}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:content}),/*#__PURE__*/_jsx(\"img\",{src:myAvatarUrl})]})]},content):/*#__PURE__*/_jsxs(\"div\",{className:styles.rightMessage,children:[/*#__PURE__*/_jsx(\"div\",{children:time}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{src:otherAvatarUrl}),/*#__PURE__*/_jsx(\"p\",{children:content})]})]},content);};var sendMessageCallBack=function sendMessageCallBack(message){console.log('message: ',message);var allUserInfos=getAllUserInfos();var curusername=getUserName();var userId=state.userId;if(userId in allUserInfos[curusername]['messageInfos']==false){allUserInfos[curusername]['messageInfos'][userId]=[];}// 更新自己的数据\nallUserInfos[curusername]['messageInfos'][userId].push({'obj':'me','time':getCurrentTimeFromYear2min(),'content':message});//更新对方的数据\nif(curusername in allUserInfos[userId]['messageInfos']==false){allUserInfos[userId]['messageInfos'][curusername]=[];}console.log(\"allUserInfos: \",allUserInfos);console.log(\"curusername: \",curusername);console.log(\"allUserInfos[userId]['messageInfos']\",allUserInfos[userId]['messageInfos']);allUserInfos[userId]['messageInfos'][curusername].push({'obj':'other','time':getCurrentTimeFromYear2min(),'content':message});var messagelist=allUserInfos[curusername]['messageInfos'][userId];setMessageLists(messagelist);console.log(\"messagelist: \",messagelist);console.log(\"userId: \",userId);console.log(\"allUserInfos: \",allUserInfos);updateAllUserInfos(allUserInfos);setinputMessage('');};if(!state)return/*#__PURE__*/_jsx(_Fragment,{});return/*#__PURE__*/_jsxs(\"div\",{className:styles.container,children:[/*#__PURE__*/_jsx(HeadNav,{title:userid}),messageLists==[]?'':/*#__PURE__*/_jsx(\"div\",{className:styles.body,children:/*#__PURE__*/_jsx(List,{children:/*#__PURE__*/_jsx(AutoSizer,{disableHeight:true,children:function children(_ref2){var width=_ref2.width;return/*#__PURE__*/_jsx(VirtualizedList,{rowCount:messageLists.length,rowRenderer:rowRenderer,width:width,height:messageLists.length*200,rowHeight:200,overscanRowCount:10});}})})}),/*#__PURE__*/_jsxs(\"div\",{className:styles.sendMessage,children:[/*#__PURE__*/_jsx(AddCircleOutline,{fontSize:30}),/*#__PURE__*/_jsx(Input,{placeholder:\"\",value:inputMessage,onChange:function onChange(val){setinputMessage(val);}}),/*#__PURE__*/_jsx(TravelOutline,{fontSize:30,onClick:function onClick(){return sendMessageCallBack(inputMessage);}})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useLocation","styles","updateAllUserInfos","getUserName","getAllUserInfos","AddCircleOutline","TravelOutline","List","VirtualizedList","AutoSizer","Input","getCurrentTimeFromYear2min","HeadNav","MessageDetails","state","messageLists","setMessageLists","myAvatarUrl","setmyAvatarUrl","otherAvatarUrl","setotherAvatarUrl","userid","setuserid","inputMessage","setinputMessage","console","log","userId","allUserInfos","curusername","messagelist","avatarUrl","rowRenderer","index","key","style","obj","time","content","leftMessage","rightMessage","sendMessageCallBack","message","push","container","body","width","length","sendMessage","val"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/src/views/MessageDetails/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { useLocation } from 'react-router-dom'\nimport styles from './index.module.css'\nimport { updateAllUserInfos, getUserName, getAllUserInfos } from '../Utils/global'\nimport { AddCircleOutline, TravelOutline } from 'antd-mobile-icons'\nimport { List as VirtualizedList, AutoSizer } from 'react-virtualized'\nimport { Input, List } from 'antd-mobile'\nimport { getCurrentTimeFromYear2min } from '../Utils/time'\nimport HeadNav from '../Component/HeadNav'\n\nexport default function MessageDetails () {\n\n  const { state } = useLocation()\n  const [messageLists, setMessageLists] = useState([])\n  const [myAvatarUrl, setmyAvatarUrl] = useState('')\n  const [otherAvatarUrl, setotherAvatarUrl] = useState('')\n  const [userid, setuserid] = useState('')\n  const [inputMessage, setinputMessage] = useState('')\n\n  console.log(\"state: \", state)\n  useEffect(() => {\n    if (state) {\n      let userId = state.userId\n      let allUserInfos = getAllUserInfos()\n      let curusername = getUserName()\n      if (userId in allUserInfos[curusername]['messageInfos']) {\n        let messagelist = allUserInfos[curusername]['messageInfos'][userId]\n        setMessageLists(messagelist)\n      }\n\n      setuserid(userId)\n      setmyAvatarUrl(allUserInfos[curusername].avatarUrl)\n      setotherAvatarUrl(allUserInfos[userId].avatarUrl)\n      // console.log(`userId:${userId}  messagelist:${messagelist}`)\n    }\n\n  }, [state])\n\n  const rowRenderer = ({ index,\n    key,\n    style, }) => {\n\n    const { obj, time, content } = messageLists[index]\n\n    return obj == 'me' ? (<div key={content} className={styles.leftMessage}>\n      <div>{time}</div>\n      <div>\n        <p>{content}</p>\n        <img src={myAvatarUrl} />\n\n      </div>\n\n    </div>) : (<div key={content} className={styles.rightMessage} >\n      <div>{time}</div>\n      <div>\n        <img src={otherAvatarUrl} />\n        <p>{content}</p>\n      </div>\n    </div>)\n\n  }\n\n\n\n  const sendMessageCallBack = (message) => {\n    console.log('message: ', message)\n\n\n\n    let allUserInfos = getAllUserInfos()\n    let curusername = getUserName()\n    let userId = state.userId\n\n    if ((userId in allUserInfos[curusername]['messageInfos']) == false) {\n      allUserInfos[curusername]['messageInfos'][userId] = []\n    }\n\n    // 更新自己的数据\n    allUserInfos[curusername]['messageInfos'][userId].push({ 'obj': 'me', 'time': getCurrentTimeFromYear2min(), 'content': message })\n\n    //更新对方的数据\n\n    if ((curusername in allUserInfos[userId]['messageInfos']) == false) {\n      allUserInfos[userId]['messageInfos'][curusername] = []\n    }\n\n    console.log(\"allUserInfos: \", allUserInfos)\n\n    console.log(\"curusername: \", curusername)\n    console.log(\"allUserInfos[userId]['messageInfos']\", allUserInfos[userId]['messageInfos'])\n\n    allUserInfos[userId]['messageInfos'][curusername].push({ 'obj': 'other', 'time': getCurrentTimeFromYear2min(), 'content': message })\n\n\n    let messagelist = allUserInfos[curusername]['messageInfos'][userId]\n    setMessageLists(messagelist)\n    console.log(\"messagelist: \", messagelist)\n\n    console.log(\"userId: \", userId)\n    console.log(\"allUserInfos: \", allUserInfos)\n\n    updateAllUserInfos(allUserInfos)\n\n\n    setinputMessage('')\n\n  }\n\n  if (!state) return <></>\n  return <div className={styles.container}>\n\n    <HeadNav title={userid} />\n    {messageLists == [] ? '' : <div className={styles.body}>\n      <List >\n        <AutoSizer disableHeight>\n          {({ width }) => (\n            <VirtualizedList\n              rowCount={messageLists.length}\n              rowRenderer={rowRenderer}\n              width={width}\n              height={messageLists.length * 200}\n              rowHeight={200}\n              overscanRowCount={10}\n            />\n          )}\n        </AutoSizer>\n      </List>\n    </div>}\n    <div className={styles.sendMessage}>\n      <AddCircleOutline fontSize={30} />\n      <Input\n        placeholder=''\n        value={inputMessage}\n        onChange={val => {\n          setinputMessage(val)\n        }}\n      />\n      <TravelOutline fontSize={30} onClick={() => sendMessageCallBack(inputMessage)} />\n    </div>\n  </div>\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}