{"ast":null,"code":"import _defineProperty from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useRef } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { Star } from './star';\nimport { useDrag } from '@use-gesture/react';\nimport { bound } from '../../utils/bound';\nvar classPrefix = \"adm-rate\";\nvar defaultProps = {\n  count: 5,\n  allowHalf: false,\n  character: React.createElement(Star, null),\n  defaultValue: 0,\n  readOnly: false,\n  allowClear: true\n};\nexport var Rate = function Rate(p) {\n  var props = mergeProps(defaultProps, p);\n\n  var _usePropsValue = usePropsValue(props),\n      _usePropsValue2 = _slicedToArray(_usePropsValue, 2),\n      value = _usePropsValue2[0],\n      setValue = _usePropsValue2[1];\n\n  var containerRef = useRef(null);\n  var starList = Array(props.count).fill(null);\n\n  function renderStar(v, half) {\n    var _classNames;\n\n    return React.createElement(\"div\", {\n      className: classNames(\"\".concat(classPrefix, \"-star\"), (_classNames = {}, _defineProperty(_classNames, \"\".concat(classPrefix, \"-star-active\"), value >= v), _defineProperty(_classNames, \"\".concat(classPrefix, \"-star-half\"), half), _defineProperty(_classNames, \"\".concat(classPrefix, \"-star-readonly\"), props.readOnly), _classNames)),\n      role: 'radio',\n      \"aria-checked\": value >= v,\n      \"aria-label\": '' + v\n    }, props.character);\n  }\n\n  var bind = useDrag(function (state) {\n    if (props.readOnly) return;\n\n    var _state$xy = _slicedToArray(state.xy, 1),\n        clientX = _state$xy[0],\n        tap = state.tap;\n\n    var container = containerRef.current;\n    if (!container) return;\n    var rect = container.getBoundingClientRect();\n    var rawValue = (clientX - rect.left) / rect.width * props.count;\n    var ceiledValue = props.allowHalf ? Math.ceil(rawValue * 2) / 2 : Math.ceil(rawValue);\n    var boundValue = bound(ceiledValue, 0, props.count);\n\n    if (tap) {\n      if (props.allowClear && boundValue === value) {\n        setValue(0);\n        return;\n      }\n    }\n\n    setValue(boundValue);\n  }, {\n    axis: 'x',\n    pointer: {\n      touch: true\n    },\n    filterTaps: true\n  });\n  return withNativeProps(props, React.createElement(\"div\", Object.assign({\n    className: classNames(classPrefix, _defineProperty({}, \"\".concat(classPrefix, \"-half\"), props.allowHalf)),\n    role: 'radiogroup',\n    \"aria-readonly\": props.readOnly,\n    ref: containerRef\n  }, bind()), starList.map(function (_, i) {\n    return React.createElement(\"div\", {\n      key: i,\n      className: classNames(\"\".concat(classPrefix, \"-box\"))\n    }, props.allowHalf && renderStar(i + 0.5, true), renderStar(i + 1, false));\n  })));\n};","map":{"version":3,"names":["React","useRef","classNames","withNativeProps","mergeProps","usePropsValue","Star","useDrag","bound","classPrefix","defaultProps","count","allowHalf","character","createElement","defaultValue","readOnly","allowClear","Rate","p","props","value","setValue","containerRef","starList","Array","fill","renderStar","v","half","className","role","bind","state","xy","clientX","tap","container","current","rect","getBoundingClientRect","rawValue","left","width","ceiledValue","Math","ceil","boundValue","axis","pointer","touch","filterTaps","Object","assign","ref","map","_","i","key"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/rate/rate.js"],"sourcesContent":["import React, { useRef } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { Star } from './star';\nimport { useDrag } from '@use-gesture/react';\nimport { bound } from '../../utils/bound';\nconst classPrefix = `adm-rate`;\nconst defaultProps = {\n  count: 5,\n  allowHalf: false,\n  character: React.createElement(Star, null),\n  defaultValue: 0,\n  readOnly: false,\n  allowClear: true\n};\nexport const Rate = p => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue(props);\n  const containerRef = useRef(null);\n  const starList = Array(props.count).fill(null);\n\n  function renderStar(v, half) {\n    return React.createElement(\"div\", {\n      className: classNames(`${classPrefix}-star`, {\n        [`${classPrefix}-star-active`]: value >= v,\n        [`${classPrefix}-star-half`]: half,\n        [`${classPrefix}-star-readonly`]: props.readOnly\n      }),\n      role: 'radio',\n      \"aria-checked\": value >= v,\n      \"aria-label\": '' + v\n    }, props.character);\n  }\n\n  const bind = useDrag(state => {\n    if (props.readOnly) return;\n    const {\n      xy: [clientX],\n      tap\n    } = state;\n    const container = containerRef.current;\n    if (!container) return;\n    const rect = container.getBoundingClientRect();\n    const rawValue = (clientX - rect.left) / rect.width * props.count;\n    const ceiledValue = props.allowHalf ? Math.ceil(rawValue * 2) / 2 : Math.ceil(rawValue);\n    const boundValue = bound(ceiledValue, 0, props.count);\n\n    if (tap) {\n      if (props.allowClear && boundValue === value) {\n        setValue(0);\n        return;\n      }\n    }\n\n    setValue(boundValue);\n  }, {\n    axis: 'x',\n    pointer: {\n      touch: true\n    },\n    filterTaps: true\n  });\n  return withNativeProps(props, React.createElement(\"div\", Object.assign({\n    className: classNames(classPrefix, {\n      [`${classPrefix}-half`]: props.allowHalf\n    }),\n    role: 'radiogroup',\n    \"aria-readonly\": props.readOnly,\n    ref: containerRef\n  }, bind()), starList.map((_, i) => React.createElement(\"div\", {\n    key: i,\n    className: classNames(`${classPrefix}-box`)\n  }, props.allowHalf && renderStar(i + 0.5, true), renderStar(i + 1, false)))));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}