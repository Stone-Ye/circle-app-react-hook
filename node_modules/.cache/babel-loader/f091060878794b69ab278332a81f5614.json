{"ast":null,"code":"import _defineProperty from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\nimport Popup from '../popup';\nimport { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nvar classPrefix = \"adm-dropdown\";\nvar defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true,\n  closeOnClickAway: false\n};\nvar Dropdown = forwardRef(function (p, ref) {\n  var props = mergeProps(defaultProps, p);\n\n  var _usePropsValue = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  }),\n      _usePropsValue2 = _slicedToArray(_usePropsValue, 2),\n      value = _usePropsValue2[0],\n      setValue = _usePropsValue2[1];\n\n  var navRef = useRef(null);\n  var contentRef = useRef(null); // 点击外部区域，关闭\n\n  useClickAway(function () {\n    if (!props.closeOnClickAway) return;\n    setValue(null);\n  }, [navRef, contentRef]); // 计算 navs 的 top 值\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      top = _useState2[0],\n      setTop = _useState2[1];\n\n  var containerRef = useRef(null);\n  useEffect(function () {\n    var container = containerRef.current;\n    if (!container) return;\n\n    if (value) {\n      var rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n\n  var changeActive = function changeActive(key) {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n\n  var popupForceRender = false;\n  var items = [];\n  var navs = React.Children.map(props.children, function (child) {\n    if (React.isValidElement(child)) {\n      var childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: function onClick() {\n          changeActive(child.key);\n        },\n        active: child.key === value,\n        arrow: child.props.arrow === undefined ? props.arrow : child.props.arrow\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  useImperativeHandle(ref, function () {\n    return {\n      close: function close() {\n        setValue(null);\n      }\n    };\n  }, [setValue]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, _defineProperty({}, \"\".concat(classPrefix, \"-open\"), !!value)),\n    ref: containerRef\n  }, React.createElement(\"div\", {\n    className: \"\".concat(classPrefix, \"-nav\"),\n    ref: navRef\n  }, navs), React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: \"\".concat(classPrefix, \"-popup\"),\n    maskClassName: \"\".concat(classPrefix, \"-popup-mask\"),\n    bodyClassName: \"\".concat(classPrefix, \"-popup-body\"),\n    style: {\n      top: top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? function () {\n      changeActive(null);\n    } : undefined\n  }, React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(function (item) {\n    var isActive = item.key === value;\n    return React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose\n    }, item.props.children);\n  })))));\n});\nexport default Dropdown;","map":{"version":3,"names":["useClickAway","classNames","React","cloneElement","useEffect","useRef","useState","forwardRef","useImperativeHandle","Popup","ItemChildrenWrap","withNativeProps","mergeProps","usePropsValue","classPrefix","defaultProps","defaultActiveKey","closeOnMaskClick","closeOnClickAway","Dropdown","p","ref","props","value","activeKey","defaultValue","onChange","setValue","navRef","contentRef","top","setTop","containerRef","container","current","rect","getBoundingClientRect","bottom","changeActive","key","popupForceRender","items","navs","Children","map","children","child","isValidElement","childProps","Object","assign","onClick","active","arrow","undefined","push","forceRender","close","createElement","className","visible","position","maskClassName","bodyClassName","style","onMaskClick","item","isActive","destroyOnClose"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/dropdown/dropdown.js"],"sourcesContent":["import { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\nimport Popup from '../popup';\nimport { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-dropdown`;\nconst defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true,\n  closeOnClickAway: false\n};\nconst Dropdown = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  });\n  const navRef = useRef(null);\n  const contentRef = useRef(null); // 点击外部区域，关闭\n\n  useClickAway(() => {\n    if (!props.closeOnClickAway) return;\n    setValue(null);\n  }, [navRef, contentRef]); // 计算 navs 的 top 值\n\n  const [top, setTop] = useState();\n  const containerRef = useRef(null);\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    if (value) {\n      const rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n\n  const changeActive = key => {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n\n  let popupForceRender = false;\n  const items = [];\n  const navs = React.Children.map(props.children, child => {\n    if (React.isValidElement(child)) {\n      const childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: () => {\n          changeActive(child.key);\n        },\n        active: child.key === value,\n        arrow: child.props.arrow === undefined ? props.arrow : child.props.arrow\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  useImperativeHandle(ref, () => ({\n    close: () => {\n      setValue(null);\n    }\n  }), [setValue]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-open`]: !!value\n    }),\n    ref: containerRef\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-nav`,\n    ref: navRef\n  }, navs), React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: `${classPrefix}-popup`,\n    maskClassName: `${classPrefix}-popup-mask`,\n    bodyClassName: `${classPrefix}-popup-body`,\n    style: {\n      top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? () => {\n      changeActive(null);\n    } : undefined\n  }, React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(item => {\n    const isActive = item.key === value;\n    return React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose\n    }, item.props.children);\n  })))));\n});\nexport default Dropdown;"],"mappings":"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"},"metadata":{},"sourceType":"module"}