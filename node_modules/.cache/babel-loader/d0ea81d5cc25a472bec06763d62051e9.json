{"ast":null,"code":"import _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useState, useRef, memo } from 'react';\nimport classNames from 'classnames';\nimport { CloseOutline, SoundOutline } from 'antd-mobile-icons';\nimport { useTimeout } from 'ahooks';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useResizeEffect } from '../../utils/use-resize-effect';\nimport { useMutationEffect } from '../../utils/use-mutation-effect';\nvar classPrefix = \"adm-notice-bar\";\nvar defaultProps = {\n  color: 'default',\n  delay: 2000,\n  speed: 50,\n  icon: React.createElement(SoundOutline, null)\n};\nexport var NoticeBar = memo(function (p) {\n  var props = mergeProps(defaultProps, p);\n  var containerRef = useRef(null);\n  var textRef = useRef(null);\n\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      visible = _useState2[0],\n      setVisible = _useState2[1];\n\n  var speed = props.speed;\n  var delayLockRef = useRef(true);\n  var animatingRef = useRef(false);\n\n  function start() {\n    if (delayLockRef.current) return;\n    var container = containerRef.current;\n    var text = textRef.current;\n    if (!container || !text) return;\n\n    if (container.offsetWidth >= text.offsetWidth) {\n      animatingRef.current = false;\n      text.style.removeProperty('transition-duration');\n      text.style.removeProperty('transform');\n      return;\n    }\n\n    if (animatingRef.current) return;\n    var initial = !text.style.transform;\n    text.style.transitionDuration = '0s';\n\n    if (initial) {\n      text.style.transform = 'translateX(0)';\n    } else {\n      text.style.transform = \"translateX(\".concat(container.offsetWidth, \"px)\");\n    }\n\n    var distance = initial ? text.offsetWidth : container.offsetWidth + text.offsetWidth;\n    animatingRef.current = true;\n    text.style.transitionDuration = \"\".concat(Math.round(distance / speed), \"s\");\n    text.style.transform = \"translateX(-\".concat(text.offsetWidth, \"px)\");\n  }\n\n  useTimeout(function () {\n    delayLockRef.current = false;\n    start();\n  }, props.delay);\n  useResizeEffect(function () {\n    start();\n  }, containerRef);\n  useMutationEffect(function () {\n    start();\n  }, textRef, {\n    subtree: true,\n    childList: true,\n    characterData: true\n  });\n  if (!visible) return null;\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, \"\".concat(classPrefix, \"-\").concat(props.color))\n  }, props.icon && React.createElement(\"span\", {\n    className: \"\".concat(classPrefix, \"-left\")\n  }, props.icon), React.createElement(\"span\", {\n    ref: containerRef,\n    className: \"\".concat(classPrefix, \"-content\")\n  }, React.createElement(\"span\", {\n    onTransitionEnd: function onTransitionEnd() {\n      animatingRef.current = false;\n      start();\n    },\n    ref: textRef,\n    className: \"\".concat(classPrefix, \"-content-inner\")\n  }, props.content)), (props.closeable || props.extra) && React.createElement(\"span\", {\n    className: \"\".concat(classPrefix, \"-right\")\n  }, props.extra, props.closeable && React.createElement(\"div\", {\n    className: \"\".concat(classPrefix, \"-close\"),\n    onClick: function onClick() {\n      var _a;\n\n      setVisible(false);\n      (_a = props.onClose) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n  }, React.createElement(CloseOutline, {\n    className: \"\".concat(classPrefix, \"-close-icon\")\n  })))));\n});","map":{"version":3,"names":["React","useState","useRef","memo","classNames","CloseOutline","SoundOutline","useTimeout","mergeProps","withNativeProps","useResizeEffect","useMutationEffect","classPrefix","defaultProps","color","delay","speed","icon","createElement","NoticeBar","p","props","containerRef","textRef","visible","setVisible","delayLockRef","animatingRef","start","current","container","text","offsetWidth","style","removeProperty","initial","transform","transitionDuration","distance","Math","round","subtree","childList","characterData","className","ref","onTransitionEnd","content","closeable","extra","onClick","_a","onClose","call"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/notice-bar/notice-bar.js"],"sourcesContent":["import React, { useState, useRef, memo } from 'react';\nimport classNames from 'classnames';\nimport { CloseOutline, SoundOutline } from 'antd-mobile-icons';\nimport { useTimeout } from 'ahooks';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useResizeEffect } from '../../utils/use-resize-effect';\nimport { useMutationEffect } from '../../utils/use-mutation-effect';\nconst classPrefix = `adm-notice-bar`;\nconst defaultProps = {\n  color: 'default',\n  delay: 2000,\n  speed: 50,\n  icon: React.createElement(SoundOutline, null)\n};\nexport const NoticeBar = memo(p => {\n  const props = mergeProps(defaultProps, p);\n  const containerRef = useRef(null);\n  const textRef = useRef(null);\n  const [visible, setVisible] = useState(true);\n  const speed = props.speed;\n  const delayLockRef = useRef(true);\n  const animatingRef = useRef(false);\n\n  function start() {\n    if (delayLockRef.current) return;\n    const container = containerRef.current;\n    const text = textRef.current;\n    if (!container || !text) return;\n\n    if (container.offsetWidth >= text.offsetWidth) {\n      animatingRef.current = false;\n      text.style.removeProperty('transition-duration');\n      text.style.removeProperty('transform');\n      return;\n    }\n\n    if (animatingRef.current) return;\n    const initial = !text.style.transform;\n    text.style.transitionDuration = '0s';\n\n    if (initial) {\n      text.style.transform = 'translateX(0)';\n    } else {\n      text.style.transform = `translateX(${container.offsetWidth}px)`;\n    }\n\n    const distance = initial ? text.offsetWidth : container.offsetWidth + text.offsetWidth;\n    animatingRef.current = true;\n    text.style.transitionDuration = `${Math.round(distance / speed)}s`;\n    text.style.transform = `translateX(-${text.offsetWidth}px)`;\n  }\n\n  useTimeout(() => {\n    delayLockRef.current = false;\n    start();\n  }, props.delay);\n  useResizeEffect(() => {\n    start();\n  }, containerRef);\n  useMutationEffect(() => {\n    start();\n  }, textRef, {\n    subtree: true,\n    childList: true,\n    characterData: true\n  });\n  if (!visible) return null;\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, `${classPrefix}-${props.color}`)\n  }, props.icon && React.createElement(\"span\", {\n    className: `${classPrefix}-left`\n  }, props.icon), React.createElement(\"span\", {\n    ref: containerRef,\n    className: `${classPrefix}-content`\n  }, React.createElement(\"span\", {\n    onTransitionEnd: () => {\n      animatingRef.current = false;\n      start();\n    },\n    ref: textRef,\n    className: `${classPrefix}-content-inner`\n  }, props.content)), (props.closeable || props.extra) && React.createElement(\"span\", {\n    className: `${classPrefix}-right`\n  }, props.extra, props.closeable && React.createElement(\"div\", {\n    className: `${classPrefix}-close`,\n    onClick: () => {\n      var _a;\n\n      setVisible(false);\n      (_a = props.onClose) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n  }, React.createElement(CloseOutline, {\n    className: `${classPrefix}-close-icon`\n  })))));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}