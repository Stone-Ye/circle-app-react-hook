{"ast":null,"code":"import _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { forwardRef, useImperativeHandle, useRef } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { Slide } from './slide';\nimport { convertPx } from '../../utils/convert-px';\nimport { bound } from '../../utils/bound';\nvar classPrefix = \"adm-image-viewer\";\nexport var Slides = forwardRef(function (props, ref) {\n  var slideWidth = window.innerWidth + convertPx(16);\n\n  var _useSpring = useSpring(function () {\n    return {\n      x: props.defaultIndex * slideWidth,\n      config: {\n        tension: 250,\n        clamp: true\n      }\n    };\n  }),\n      _useSpring2 = _slicedToArray(_useSpring, 2),\n      x = _useSpring2[0].x,\n      api = _useSpring2[1];\n\n  var count = props.images.length;\n\n  function swipeTo(index) {\n    var immediate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    var _a;\n\n    var i = bound(index, 0, count - 1);\n    (_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, i);\n    api.start({\n      x: i * slideWidth,\n      immediate: immediate\n    });\n  }\n\n  useImperativeHandle(ref, function () {\n    return {\n      swipeTo: swipeTo\n    };\n  });\n  var dragLockRef = useRef(false);\n  var bind = useDrag(function (state) {\n    if (dragLockRef.current) return;\n\n    var _state$offset = _slicedToArray(state.offset, 1),\n        offsetX = _state$offset[0];\n\n    if (state.last) {\n      var minIndex = Math.floor(offsetX / slideWidth);\n      var maxIndex = minIndex + 1;\n      var velocityOffset = Math.min(state.velocity[0] * 2000, slideWidth) * state.direction[0];\n      swipeTo(bound(Math.round((offsetX + velocityOffset) / slideWidth), minIndex, maxIndex));\n    } else {\n      api.start({\n        x: offsetX,\n        immediate: true\n      });\n    }\n  }, {\n    transform: function transform(_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n          x = _ref2[0],\n          y = _ref2[1];\n\n      return [-x, y];\n    },\n    from: function from() {\n      return [x.get(), 0];\n    },\n    bounds: function bounds() {\n      return {\n        left: 0,\n        right: (count - 1) * slideWidth\n      };\n    },\n    rubberband: true,\n    axis: 'x',\n    pointer: {\n      touch: true\n    }\n  });\n  return React.createElement(\"div\", Object.assign({\n    className: \"\".concat(classPrefix, \"-slides\")\n  }, bind()), React.createElement(animated.div, {\n    className: \"\".concat(classPrefix, \"-indicator\")\n  }, x.to(function (v) {\n    var index = bound(Math.round(v / slideWidth), 0, count - 1);\n    return \"\".concat(index + 1, \" / \").concat(count);\n  })), React.createElement(animated.div, {\n    className: \"\".concat(classPrefix, \"-slides-inner\"),\n    style: {\n      x: x.to(function (x) {\n        return -x;\n      })\n    }\n  }, props.images.map(function (image, index) {\n    return React.createElement(Slide, {\n      key: index,\n      image: image,\n      onTap: props.onTap,\n      maxZoom: props.maxZoom,\n      onZoomChange: function onZoomChange(zoom) {\n        if (zoom !== 1) {\n          var _index = Math.round(x.get() / slideWidth);\n\n          api.start({\n            x: _index * slideWidth\n          });\n        }\n      },\n      dragLockRef: dragLockRef\n    });\n  })));\n});","map":{"version":3,"names":["React","forwardRef","useImperativeHandle","useRef","useDrag","useSpring","animated","Slide","convertPx","bound","classPrefix","Slides","props","ref","slideWidth","window","innerWidth","x","defaultIndex","config","tension","clamp","api","count","images","length","swipeTo","index","immediate","_a","i","onIndexChange","call","start","dragLockRef","bind","state","current","offset","offsetX","last","minIndex","Math","floor","maxIndex","velocityOffset","min","velocity","direction","round","transform","y","from","get","bounds","left","right","rubberband","axis","pointer","touch","createElement","Object","assign","className","div","to","v","style","map","image","key","onTap","maxZoom","onZoomChange","zoom"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/image-viewer/slides.js"],"sourcesContent":["import React, { forwardRef, useImperativeHandle, useRef } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { Slide } from './slide';\nimport { convertPx } from '../../utils/convert-px';\nimport { bound } from '../../utils/bound';\nconst classPrefix = `adm-image-viewer`;\nexport const Slides = forwardRef((props, ref) => {\n  const slideWidth = window.innerWidth + convertPx(16);\n  const [{\n    x\n  }, api] = useSpring(() => ({\n    x: props.defaultIndex * slideWidth,\n    config: {\n      tension: 250,\n      clamp: true\n    }\n  }));\n  const count = props.images.length;\n\n  function swipeTo(index, immediate = false) {\n    var _a;\n\n    const i = bound(index, 0, count - 1);\n    (_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, i);\n    api.start({\n      x: i * slideWidth,\n      immediate\n    });\n  }\n\n  useImperativeHandle(ref, () => ({\n    swipeTo\n  }));\n  const dragLockRef = useRef(false);\n  const bind = useDrag(state => {\n    if (dragLockRef.current) return;\n    const [offsetX] = state.offset;\n\n    if (state.last) {\n      const minIndex = Math.floor(offsetX / slideWidth);\n      const maxIndex = minIndex + 1;\n      const velocityOffset = Math.min(state.velocity[0] * 2000, slideWidth) * state.direction[0];\n      swipeTo(bound(Math.round((offsetX + velocityOffset) / slideWidth), minIndex, maxIndex));\n    } else {\n      api.start({\n        x: offsetX,\n        immediate: true\n      });\n    }\n  }, {\n    transform: ([x, y]) => [-x, y],\n    from: () => [x.get(), 0],\n    bounds: () => {\n      return {\n        left: 0,\n        right: (count - 1) * slideWidth\n      };\n    },\n    rubberband: true,\n    axis: 'x',\n    pointer: {\n      touch: true\n    }\n  });\n  return React.createElement(\"div\", Object.assign({\n    className: `${classPrefix}-slides`\n  }, bind()), React.createElement(animated.div, {\n    className: `${classPrefix}-indicator`\n  }, x.to(v => {\n    const index = bound(Math.round(v / slideWidth), 0, count - 1);\n    return `${index + 1} / ${count}`;\n  })), React.createElement(animated.div, {\n    className: `${classPrefix}-slides-inner`,\n    style: {\n      x: x.to(x => -x)\n    }\n  }, props.images.map((image, index) => React.createElement(Slide, {\n    key: index,\n    image: image,\n    onTap: props.onTap,\n    maxZoom: props.maxZoom,\n    onZoomChange: zoom => {\n      if (zoom !== 1) {\n        const index = Math.round(x.get() / slideWidth);\n        api.start({\n          x: index * slideWidth\n        });\n      }\n    },\n    dragLockRef: dragLockRef\n  }))));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}