{"ast":null,"code":"import _defineProperty from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nvar classPrefix = \"adm-water-mark\";\nvar defaultProps = {\n  fullPage: true\n};\nexport var WaterMark = function WaterMark(p) {\n  var props = mergeProps(defaultProps, p);\n  var _props$zIndex = props.zIndex,\n      zIndex = _props$zIndex === void 0 ? 2000 : _props$zIndex,\n      _props$gapX = props.gapX,\n      gapX = _props$gapX === void 0 ? 24 : _props$gapX,\n      _props$gapY = props.gapY,\n      gapY = _props$gapY === void 0 ? 48 : _props$gapY,\n      _props$width = props.width,\n      width = _props$width === void 0 ? 120 : _props$width,\n      _props$height = props.height,\n      height = _props$height === void 0 ? 64 : _props$height,\n      _props$rotate = props.rotate,\n      rotate = _props$rotate === void 0 ? -22 : _props$rotate,\n      image = props.image,\n      _props$imageWidth = props.imageWidth,\n      imageWidth = _props$imageWidth === void 0 ? 120 : _props$imageWidth,\n      _props$imageHeight = props.imageHeight,\n      imageHeight = _props$imageHeight === void 0 ? 64 : _props$imageHeight,\n      content = props.content,\n      _props$fontStyle = props.fontStyle,\n      fontStyle = _props$fontStyle === void 0 ? 'normal' : _props$fontStyle,\n      _props$fontWeight = props.fontWeight,\n      fontWeight = _props$fontWeight === void 0 ? 'normal' : _props$fontWeight,\n      _props$fontColor = props.fontColor,\n      fontColor = _props$fontColor === void 0 ? 'rgba(0,0,0,.15)' : _props$fontColor,\n      _props$fontSize = props.fontSize,\n      fontSize = _props$fontSize === void 0 ? 14 : _props$fontSize,\n      _props$fontFamily = props.fontFamily,\n      fontFamily = _props$fontFamily === void 0 ? 'sans-serif' : _props$fontFamily;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      base64Url = _useState2[0],\n      setBase64Url = _useState2[1];\n\n  useEffect(function () {\n    var canvas = document.createElement('canvas');\n    var ratio = window.devicePixelRatio;\n    var ctx = canvas.getContext('2d');\n    var canvasWidth = \"\".concat((gapX + width) * ratio, \"px\");\n    var canvasHeight = \"\".concat((gapY + height) * ratio, \"px\");\n    var markWidth = width * ratio;\n    var markHeight = height * ratio;\n    canvas.setAttribute('width', canvasWidth);\n    canvas.setAttribute('height', canvasHeight);\n\n    if (ctx) {\n      if (image) {\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        var img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.referrerPolicy = 'no-referrer';\n\n        img.onload = function () {\n          ctx.drawImage(img, -imageWidth * ratio / 2, -imageHeight * ratio / 2, imageWidth * ratio, imageHeight * ratio);\n          ctx.restore();\n          setBase64Url(canvas.toDataURL());\n        };\n\n        img.src = image;\n      } else if (content) {\n        ctx.textBaseline = 'middle';\n        ctx.textAlign = 'center'; // 文字绕中间旋转\n\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        var markSize = Number(fontSize) * ratio;\n        ctx.font = \"\".concat(fontStyle, \" normal \").concat(fontWeight, \" \").concat(markSize, \"px/\").concat(markHeight, \"px \").concat(fontFamily);\n        ctx.fillStyle = fontColor;\n        ctx.fillText(content, 0, 0);\n        ctx.restore();\n        setBase64Url(canvas.toDataURL());\n      }\n    } else {\n      throw new Error('Canvas is not supported in the current environment');\n    }\n  }, [gapX, gapY, rotate, fontStyle, fontWeight, width, height, fontFamily, fontColor, image, content, fontSize]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, _defineProperty({}, \"\".concat(classPrefix, \"-full-page\"), props.fullPage)),\n    style: {\n      zIndex: zIndex,\n      backgroundSize: \"\".concat(gapX + width, \"px\"),\n      backgroundImage: \"url('\".concat(base64Url, \"')\")\n    }\n  }));\n};","map":{"version":3,"names":["classNames","React","useEffect","useState","withNativeProps","mergeProps","classPrefix","defaultProps","fullPage","WaterMark","p","props","zIndex","gapX","gapY","width","height","rotate","image","imageWidth","imageHeight","content","fontStyle","fontWeight","fontColor","fontSize","fontFamily","base64Url","setBase64Url","canvas","document","createElement","ratio","window","devicePixelRatio","ctx","getContext","canvasWidth","canvasHeight","markWidth","markHeight","setAttribute","translate","Math","PI","Number","img","Image","crossOrigin","referrerPolicy","onload","drawImage","restore","toDataURL","src","textBaseline","textAlign","markSize","font","fillStyle","fillText","Error","className","style","backgroundSize","backgroundImage"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/water-mark/water-mark.js"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nconst classPrefix = `adm-water-mark`;\nconst defaultProps = {\n  fullPage: true\n};\nexport const WaterMark = p => {\n  const props = mergeProps(defaultProps, p);\n  const {\n    zIndex = 2000,\n    gapX = 24,\n    gapY = 48,\n    width = 120,\n    height = 64,\n    rotate = -22,\n    image,\n    imageWidth = 120,\n    imageHeight = 64,\n    content,\n    fontStyle = 'normal',\n    fontWeight = 'normal',\n    fontColor = 'rgba(0,0,0,.15)',\n    fontSize = 14,\n    fontFamily = 'sans-serif'\n  } = props;\n  const [base64Url, setBase64Url] = useState('');\n  useEffect(() => {\n    const canvas = document.createElement('canvas');\n    const ratio = window.devicePixelRatio;\n    const ctx = canvas.getContext('2d');\n    const canvasWidth = `${(gapX + width) * ratio}px`;\n    const canvasHeight = `${(gapY + height) * ratio}px`;\n    const markWidth = width * ratio;\n    const markHeight = height * ratio;\n    canvas.setAttribute('width', canvasWidth);\n    canvas.setAttribute('height', canvasHeight);\n\n    if (ctx) {\n      if (image) {\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.referrerPolicy = 'no-referrer';\n\n        img.onload = () => {\n          ctx.drawImage(img, -imageWidth * ratio / 2, -imageHeight * ratio / 2, imageWidth * ratio, imageHeight * ratio);\n          ctx.restore();\n          setBase64Url(canvas.toDataURL());\n        };\n\n        img.src = image;\n      } else if (content) {\n        ctx.textBaseline = 'middle';\n        ctx.textAlign = 'center'; // 文字绕中间旋转\n\n        ctx.translate(markWidth / 2, markHeight / 2);\n        ctx.rotate(Math.PI / 180 * Number(rotate));\n        const markSize = Number(fontSize) * ratio;\n        ctx.font = `${fontStyle} normal ${fontWeight} ${markSize}px/${markHeight}px ${fontFamily}`;\n        ctx.fillStyle = fontColor;\n        ctx.fillText(content, 0, 0);\n        ctx.restore();\n        setBase64Url(canvas.toDataURL());\n      }\n    } else {\n      throw new Error('Canvas is not supported in the current environment');\n    }\n  }, [gapX, gapY, rotate, fontStyle, fontWeight, width, height, fontFamily, fontColor, image, content, fontSize]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-full-page`]: props.fullPage\n    }),\n    style: {\n      zIndex,\n      backgroundSize: `${gapX + width}px`,\n      backgroundImage: `url('${base64Url}')`\n    }\n  }));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}