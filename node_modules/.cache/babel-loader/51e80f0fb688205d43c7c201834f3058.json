{"ast":null,"code":"import _defineProperty from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport classNames from 'classnames';\nimport React, { useMemo } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getTreeDeep } from '../../utils/tree';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nvar classPrefix = \"adm-tree-select\";\nvar defaultProps = {\n  options: [],\n  fieldNames: {},\n  defaultValue: []\n};\nexport var TreeSelect = function TreeSelect(p) {\n  var props = mergeProps(defaultProps, p);\n  var labelName = props.fieldNames.label || 'label';\n  var valueName = props.fieldNames.value || 'value';\n  var childrenName = props.fieldNames.children || 'children';\n\n  var _usePropsValue = usePropsValue({\n    value: props.value,\n    defaultValue: props.defaultValue\n  }),\n      _usePropsValue2 = _slicedToArray(_usePropsValue, 2),\n      value = _usePropsValue2[0],\n      setValue = _usePropsValue2[1];\n\n  var _useMemo = useMemo(function () {\n    var deep = getTreeDeep(props.options, childrenName);\n    var optionsMap = new Map();\n    var optionsParentMap = new Map();\n\n    function traverse(current, children) {\n      children.forEach(function (item) {\n        optionsParentMap.set(item[valueName], current);\n        optionsMap.set(item[valueName], item);\n\n        if (item[childrenName]) {\n          traverse(item, item[childrenName]);\n        }\n      });\n    }\n\n    traverse(undefined, props.options);\n    return [deep, optionsMap, optionsParentMap];\n  }, [props.options]),\n      _useMemo2 = _slicedToArray(_useMemo, 3),\n      deep = _useMemo2[0],\n      optionsMap = _useMemo2[1],\n      optionsParentMap = _useMemo2[2];\n\n  var onItemSelect = function onItemSelect(node) {\n    var _a; // 找到父级节点\n\n\n    var parentNodes = [];\n    var current = node;\n\n    while (current) {\n      parentNodes.push(current);\n      var next = optionsParentMap.get(current[valueName]);\n      current = next;\n    }\n\n    var values = parentNodes.reverse().map(function (i) {\n      return i[valueName];\n    });\n    setValue(values);\n    (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, values, {\n      options: parentNodes\n    });\n  };\n\n  var renderItems = function renderItems() {\n    var columnOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var index = arguments.length > 1 ? arguments[1] : undefined;\n    return columnOptions.map(function (item) {\n      var isActive = item[valueName] === value[index];\n      return React.createElement(\"div\", {\n        key: item[valueName],\n        className: classNames(\"\".concat(classPrefix, \"-item\"), _defineProperty({}, \"\".concat(classPrefix, \"-item-active\"), isActive)),\n        onClick: function onClick() {\n          if (!isActive) {\n            onItemSelect(item);\n          }\n        }\n      }, item[labelName]);\n    });\n  };\n\n  var renderColumns = function renderColumns() {\n    var _a;\n\n    var columns = [];\n\n    for (var i = 0; i < deep; i++) {\n      var width = \"\".concat(100 / deep, \"%\"); // 两列的第一列宽度为 33.33，两列的第二列为 66.67%\n\n      if (deep === 2 && i === 0) {\n        width = \"33.33%\";\n      }\n\n      if (deep === 2 && i === 1) {\n        width = \"66.67%\";\n      }\n\n      var column = React.createElement(\"div\", {\n        key: i,\n        className: classNames(\"\".concat(classPrefix, \"-column\")),\n        style: {\n          width: width\n        }\n      }, renderItems(i === 0 ? props.options : (_a = optionsMap.get(value[i - 1])) === null || _a === void 0 ? void 0 : _a[childrenName], i));\n      columns.push(column);\n    }\n\n    return columns;\n  };\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, renderColumns()));\n};","map":{"version":3,"names":["classNames","React","useMemo","withNativeProps","getTreeDeep","mergeProps","usePropsValue","classPrefix","defaultProps","options","fieldNames","defaultValue","TreeSelect","p","props","labelName","label","valueName","value","childrenName","children","setValue","deep","optionsMap","Map","optionsParentMap","traverse","current","forEach","item","set","undefined","onItemSelect","node","_a","parentNodes","push","next","get","values","reverse","map","i","onChange","call","renderItems","columnOptions","index","isActive","createElement","key","className","onClick","renderColumns","columns","width","column","style"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/tree-select/tree-select.js"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useMemo } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getTreeDeep } from '../../utils/tree';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-tree-select`;\nconst defaultProps = {\n  options: [],\n  fieldNames: {},\n  defaultValue: []\n};\nexport const TreeSelect = p => {\n  const props = mergeProps(defaultProps, p);\n  const labelName = props.fieldNames.label || 'label';\n  const valueName = props.fieldNames.value || 'value';\n  const childrenName = props.fieldNames.children || 'children';\n  const [value, setValue] = usePropsValue({\n    value: props.value,\n    defaultValue: props.defaultValue\n  });\n  const [deep, optionsMap, optionsParentMap] = useMemo(() => {\n    const deep = getTreeDeep(props.options, childrenName);\n    const optionsMap = new Map();\n    const optionsParentMap = new Map();\n\n    function traverse(current, children) {\n      children.forEach(item => {\n        optionsParentMap.set(item[valueName], current);\n        optionsMap.set(item[valueName], item);\n\n        if (item[childrenName]) {\n          traverse(item, item[childrenName]);\n        }\n      });\n    }\n\n    traverse(undefined, props.options);\n    return [deep, optionsMap, optionsParentMap];\n  }, [props.options]);\n\n  const onItemSelect = node => {\n    var _a; // 找到父级节点\n\n\n    const parentNodes = [];\n    let current = node;\n\n    while (current) {\n      parentNodes.push(current);\n      const next = optionsParentMap.get(current[valueName]);\n      current = next;\n    }\n\n    const values = parentNodes.reverse().map(i => i[valueName]);\n    setValue(values);\n    (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, values, {\n      options: parentNodes\n    });\n  };\n\n  const renderItems = (columnOptions = [], index) => {\n    return columnOptions.map(item => {\n      const isActive = item[valueName] === value[index];\n      return React.createElement(\"div\", {\n        key: item[valueName],\n        className: classNames(`${classPrefix}-item`, {\n          [`${classPrefix}-item-active`]: isActive\n        }),\n        onClick: () => {\n          if (!isActive) {\n            onItemSelect(item);\n          }\n        }\n      }, item[labelName]);\n    });\n  };\n\n  const renderColumns = () => {\n    var _a;\n\n    const columns = [];\n\n    for (let i = 0; i < deep; i++) {\n      let width = `${100 / deep}%`; // 两列的第一列宽度为 33.33，两列的第二列为 66.67%\n\n      if (deep === 2 && i === 0) {\n        width = `33.33%`;\n      }\n\n      if (deep === 2 && i === 1) {\n        width = `66.67%`;\n      }\n\n      const column = React.createElement(\"div\", {\n        key: i,\n        className: classNames(`${classPrefix}-column`),\n        style: {\n          width\n        }\n      }, renderItems(i === 0 ? props.options : (_a = optionsMap.get(value[i - 1])) === null || _a === void 0 ? void 0 : _a[childrenName], i));\n      columns.push(column);\n    }\n\n    return columns;\n  };\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, renderColumns()));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}