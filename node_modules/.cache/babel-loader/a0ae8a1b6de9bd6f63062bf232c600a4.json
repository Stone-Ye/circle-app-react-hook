{"ast":null,"code":"import _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useRef } from 'react';\nimport { useSpring, animated, to } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nvar classPrefix = \"adm-floating-bubble\";\nvar defaultProps = {\n  axis: 'y'\n};\nexport var FloatingBubble = function FloatingBubble(p) {\n  var props = mergeProps(defaultProps, p);\n  var boundaryRef = useRef(null);\n  var buttonRef = useRef(null);\n  /**\n   * memoize the `to` function\n   * inside a component that renders frequently\n   * to prevent an unintended restart\n   */\n\n  var _useSpring = useSpring(function () {\n    return {\n      x: 0,\n      y: 0,\n      opacity: 1\n    };\n  }),\n      _useSpring2 = _slicedToArray(_useSpring, 2),\n      _useSpring2$ = _useSpring2[0],\n      x = _useSpring2$.x,\n      y = _useSpring2$.y,\n      opacity = _useSpring2$.opacity,\n      api = _useSpring2[1];\n\n  var bind = useDrag(function (state) {\n    var nextX = state.offset[0];\n    var nextY = state.offset[1];\n\n    if (state.last && props.magnetic) {\n      var boundary = boundaryRef.current;\n      var button = buttonRef.current;\n      if (!boundary || !button) return;\n      var boundaryRect = boundary.getBoundingClientRect();\n      var buttonRect = button.getBoundingClientRect();\n\n      if (props.magnetic === 'x') {\n        var compensation = x.goal - x.get();\n        var leftDistance = buttonRect.left + compensation - boundaryRect.left;\n        var rightDistance = boundaryRect.right - (buttonRect.right + compensation);\n\n        if (rightDistance <= leftDistance) {\n          nextX += rightDistance;\n        } else {\n          nextX -= leftDistance;\n        }\n      } else if (props.magnetic === 'y') {\n        var _compensation = y.goal - y.get();\n\n        var topDistance = buttonRect.top + _compensation - boundaryRect.top;\n        var bottomDistance = boundaryRect.bottom - (buttonRect.bottom + _compensation);\n\n        if (bottomDistance <= topDistance) {\n          nextY += bottomDistance;\n        } else {\n          nextY -= topDistance;\n        }\n      }\n    }\n\n    api.start({\n      x: nextX,\n      y: nextY\n    }); // active status\n\n    api.start({\n      opacity: state.active ? 0.8 : 1\n    });\n  }, {\n    axis: props.axis === 'xy' ? undefined : props.axis,\n    pointer: {\n      touch: true\n    },\n    // the component won't trigger drag logic if the user just clicked on the component.\n    filterTaps: true,\n    // set constraints to the user gesture\n    bounds: boundaryRef,\n    from: function from() {\n      return [x.get(), y.get()];\n    }\n  });\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, React.createElement(\"div\", {\n    className: \"\".concat(classPrefix, \"-boundary-outer\")\n  }, React.createElement(\"div\", {\n    className: \"\".concat(classPrefix, \"-boundary\"),\n    ref: boundaryRef\n  })), React.createElement(animated.div, Object.assign({}, bind(), {\n    style: {\n      opacity: opacity,\n      transform: to([x, y], function (x, y) {\n        return \"translate(\".concat(x, \"px, \").concat(y, \"px)\");\n      })\n    },\n    onClick: props.onClick,\n    className: \"\".concat(classPrefix, \"-button\"),\n    ref: buttonRef\n  }), props.children)));\n};","map":{"version":3,"names":["React","useRef","useSpring","animated","to","useDrag","mergeProps","withNativeProps","classPrefix","defaultProps","axis","FloatingBubble","p","props","boundaryRef","buttonRef","x","y","opacity","api","bind","state","nextX","offset","nextY","last","magnetic","boundary","current","button","boundaryRect","getBoundingClientRect","buttonRect","compensation","goal","get","leftDistance","left","rightDistance","right","topDistance","top","bottomDistance","bottom","start","active","undefined","pointer","touch","filterTaps","bounds","from","createElement","className","ref","div","Object","assign","style","transform","onClick","children"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/floating-bubble/floating-bubble.js"],"sourcesContent":["import React, { useRef } from 'react';\nimport { useSpring, animated, to } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nconst classPrefix = `adm-floating-bubble`;\nconst defaultProps = {\n  axis: 'y'\n};\nexport const FloatingBubble = p => {\n  const props = mergeProps(defaultProps, p);\n  const boundaryRef = useRef(null);\n  const buttonRef = useRef(null);\n  /**\n   * memoize the `to` function\n   * inside a component that renders frequently\n   * to prevent an unintended restart\n   */\n\n  const [{\n    x,\n    y,\n    opacity\n  }, api] = useSpring(() => ({\n    x: 0,\n    y: 0,\n    opacity: 1\n  }));\n  const bind = useDrag(state => {\n    let nextX = state.offset[0];\n    let nextY = state.offset[1];\n\n    if (state.last && props.magnetic) {\n      const boundary = boundaryRef.current;\n      const button = buttonRef.current;\n      if (!boundary || !button) return;\n      const boundaryRect = boundary.getBoundingClientRect();\n      const buttonRect = button.getBoundingClientRect();\n\n      if (props.magnetic === 'x') {\n        const compensation = x.goal - x.get();\n        const leftDistance = buttonRect.left + compensation - boundaryRect.left;\n        const rightDistance = boundaryRect.right - (buttonRect.right + compensation);\n\n        if (rightDistance <= leftDistance) {\n          nextX += rightDistance;\n        } else {\n          nextX -= leftDistance;\n        }\n      } else if (props.magnetic === 'y') {\n        const compensation = y.goal - y.get();\n        const topDistance = buttonRect.top + compensation - boundaryRect.top;\n        const bottomDistance = boundaryRect.bottom - (buttonRect.bottom + compensation);\n\n        if (bottomDistance <= topDistance) {\n          nextY += bottomDistance;\n        } else {\n          nextY -= topDistance;\n        }\n      }\n    }\n\n    api.start({\n      x: nextX,\n      y: nextY\n    }); // active status\n\n    api.start({\n      opacity: state.active ? 0.8 : 1\n    });\n  }, {\n    axis: props.axis === 'xy' ? undefined : props.axis,\n    pointer: {\n      touch: true\n    },\n    // the component won't trigger drag logic if the user just clicked on the component.\n    filterTaps: true,\n    // set constraints to the user gesture\n    bounds: boundaryRef,\n    from: () => [x.get(), y.get()]\n  });\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-boundary-outer`\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-boundary`,\n    ref: boundaryRef\n  })), React.createElement(animated.div, Object.assign({}, bind(), {\n    style: {\n      opacity,\n      transform: to([x, y], (x, y) => `translate(${x}px, ${y}px)`)\n    },\n    onClick: props.onClick,\n    className: `${classPrefix}-button`,\n    ref: buttonRef\n  }), props.children)));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}