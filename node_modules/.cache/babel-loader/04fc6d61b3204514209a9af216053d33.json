{"ast":null,"code":"import _slicedToArray from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{useNavigate,useLocation}from'react-router-dom';import{Space,Modal,Radio,TextArea,Input,Form,Button}from'antd-mobile';import styles from'./index.module.css';import{getAllUserInfos,updateAllUserInfos,getUserName}from'../Utils/global';import{getCurrentTime}from'../Utils/time';import HeadNav from'../Component/HeadNav';import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Buy(){var navigate=useNavigate();var _useLocation=useLocation(),state=_useLocation.state;console.log(\"buy: state: \",state);// address infos\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),deliveryAddress=_useState2[0],setDeliveryAddress=_useState2[1];// pickup face-to-face;   delivery\nvar _useState3=useState('pickup'),_useState4=_slicedToArray(_useState3,2),isPickOrDelivery=_useState4[0],setIsPickOrDelivery=_useState4[1];var onComfirmedCallback=function onComfirmedCallback(_ref){var offerPrice=_ref.offerPrice;var productInfos=state.productInfos;var productId=productInfos.productId,category=productInfos.category,imgs=productInfos.imgs,title=productInfos.title,price=productInfos.price,desc=productInfos.desc,seller=productInfos.seller;Modal.confirm({content:'Your Offer is Completed !',confirmText:'Continue Shopping',cancelText:'Offer History',onConfirm:function onConfirm(){navigate('/home');},onCancel:function onCancel(){return navigate('/offerhistory');}});var allUserInfos=getAllUserInfos();var curUsername=getUserName();console.log(\"buy allUserInfos[seller]['offers'].length:\",allUserInfos[curUsername]['offers'].length);// add an offer record for curusername (buyer)\nvar curtime=getCurrentTime();var newOfferObj={'productId':productId,'offerPrice':offerPrice,'time':curtime,'itemId':allUserInfos[curUsername]['offers'].length,'stepInfos':{'status':0,'time':curtime},//0: waiting，1:agree, 2:rejected\n'isValid':1// 1:valid，2:not valid \n};// add an order record for seller\nvar newOrderObj={'buyer':getUserName(),'productId':productId,'offerPrice':offerPrice,'time':curtime,'isPickOrDelivery':isPickOrDelivery,'deliveryAddress':deliveryAddress,'status':0,'offerId':allUserInfos[curUsername]['offers'].length,'itemId':allUserInfos[seller]['orders'].length,'isValid':1// 1有效，2无效\n};allUserInfos[curUsername]['offers'].push(newOfferObj);allUserInfos[seller]['orders'].push(newOrderObj);updateAllUserInfos(allUserInfos);};if(!state)return/*#__PURE__*/_jsx(_Fragment,{});var productInfos=state.productInfos;console.log(\"productInfos: \",productInfos);var imgs=productInfos.imgs,title=productInfos.title,price=productInfos.price;return/*#__PURE__*/_jsxs(\"div\",{className:styles.container,children:[/*#__PURE__*/_jsx(HeadNav,{title:\"Place an Offer\"}),/*#__PURE__*/_jsxs(\"div\",{className:styles.body,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.bodyCard1,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:imgs[0]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:title}),/*#__PURE__*/_jsx(\"div\",{children:price})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.bodyCard2,children:[/*#__PURE__*/_jsx(\"div\",{children:\"Delivery Address\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Radio.Group,{defaultValue:\"pickup\",onChange:function onChange(val){return setIsPickOrDelivery(val);},children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsx(Radio,{value:\"pickup\",style:{'--icon-size':'18px','--font-size':'14px','--gap':'10px'},children:\"Pick up face-to-face (If you choose this option, please talk to seller first.)\"}),/*#__PURE__*/_jsx(Radio,{value:\"delivery\",style:{'--icon-size':'18px','--font-size':'14px','--gap':'10px'},children:\"Delivery\"})]})})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(TextArea,{defaultValue:'Please type your address',value:deliveryAddress,onChange:function onChange(val){return setDeliveryAddress(val);},style:{'--font-size':'10px'},showCount:true})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.bottom,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.form}),/*#__PURE__*/_jsxs(Form,{layout:\"horizontal\",onFinish:function onFinish(value){return onComfirmedCallback(value);},footer:/*#__PURE__*/_jsx(Button,{block:true,type:\"submit\",color:\"primary\",size:\"large\",children:\"Comfirmed Offer\"}),children:[/*#__PURE__*/_jsx(Form.Item,{label:\"Asking Price\",name:\"askingPrice\",extra:/*#__PURE__*/_jsx(\"a\",{children:price})// rules={[{ required: true, message: 'Asking Price must be required' }]}\n}),/*#__PURE__*/_jsx(Form.Item,{label:\"Offer Price\",name:\"offerPrice\",rules:[{required:true,message:'Offer Price must be required'}],children:/*#__PURE__*/_jsx(Input,{onChange:console.log,placeholder:\"Input the offer price\"})})]})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useLocation","Space","Modal","Radio","TextArea","Input","Form","Button","styles","getAllUserInfos","updateAllUserInfos","getUserName","getCurrentTime","HeadNav","Buy","navigate","state","console","log","deliveryAddress","setDeliveryAddress","isPickOrDelivery","setIsPickOrDelivery","onComfirmedCallback","offerPrice","productInfos","productId","category","imgs","title","price","desc","seller","confirm","content","confirmText","cancelText","onConfirm","onCancel","allUserInfos","curUsername","length","curtime","newOfferObj","newOrderObj","push","container","body","bodyCard1","bodyCard2","val","bottom","form","value","required","message"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/src/views/Buy/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport {\n  useNavigate, useLocation\n} from 'react-router-dom'\n\nimport { Space, Modal, Radio, TextArea, Input, Form, Button } from 'antd-mobile'\nimport styles from './index.module.css'\n\nimport { getAllUserInfos, updateAllUserInfos, getUserName } from '../Utils/global'\nimport { getCurrentTime } from '../Utils/time'\nimport HeadNav from '../Component/HeadNav'\n\nexport default function Buy () {\n  const navigate = useNavigate()\n  const { state } = useLocation()\n  console.log(\"buy: state: \", state)\n\n\n  // address infos\n  const [deliveryAddress, setDeliveryAddress] = useState('')\n\n  // pickup face-to-face;   delivery\n  const [isPickOrDelivery, setIsPickOrDelivery] = useState('pickup')\n\n\n\n\n\n  const onComfirmedCallback = ({ offerPrice }) => {\n\n    const { productInfos } = state\n    const { productId, category, imgs, title, price, desc, seller } = productInfos\n\n    Modal.confirm({\n      content: 'Your Offer is Completed !',\n      confirmText: 'Continue Shopping',\n      cancelText: 'Offer History',\n      onConfirm: () => {\n        navigate('/home')\n      },\n      onCancel: () => navigate('/offerhistory')\n    })\n\n    let allUserInfos = getAllUserInfos()\n    let curUsername = getUserName()\n    console.log(\"buy allUserInfos[seller]['offers'].length:\", allUserInfos[curUsername]['offers'].length)\n\n\n\n    // add an offer record for curusername (buyer)\n    let curtime = getCurrentTime()\n    let newOfferObj = {\n      'productId': productId,\n      'offerPrice': offerPrice,\n      'time': curtime,\n      'itemId': allUserInfos[curUsername]['offers'].length,\n      'stepInfos': { 'status': 0, 'time': curtime },   //0: waiting，1:agree, 2:rejected\n      'isValid': 1 // 1:valid，2:not valid \n    }\n    // add an order record for seller\n    let newOrderObj = {\n      'buyer': getUserName(),\n      'productId': productId,\n      'offerPrice': offerPrice,\n      'time': curtime,\n      'isPickOrDelivery': isPickOrDelivery,\n      'deliveryAddress': deliveryAddress,\n      'status': 0,\n      'offerId': allUserInfos[curUsername]['offers'].length,\n      'itemId': allUserInfos[seller]['orders'].length,\n      'isValid': 1 // 1有效，2无效\n\n    }\n\n    allUserInfos[curUsername]['offers'].push(newOfferObj)\n    allUserInfos[seller]['orders'].push(newOrderObj)\n    updateAllUserInfos(allUserInfos)\n\n\n  }\n\n\n\n  if (!state) return <></>\n\n\n\n\n  const { productInfos } = state\n  console.log(\"productInfos: \", productInfos)\n  const { imgs, title, price } = productInfos\n\n  return <div className={styles.container}>\n\n    <HeadNav title='Place an Offer' />\n    <div className={styles.body}>\n      <div className={styles.bodyCard1}>\n        <div>\n          <img src={imgs[0]} />\n        </div>\n        <div>\n          <div>{title}</div>\n          <div>{price}</div>\n        </div>\n      </div>\n\n      <div className={styles.bodyCard2}>\n        <div>\n          Delivery Address\n        </div>\n        <div>\n          <div>\n            <Radio.Group defaultValue='pickup' onChange={(val) => setIsPickOrDelivery(val)}>\n              <Space direction='vertical'>\n                <Radio value='pickup' style={{\n                  '--icon-size': '18px',\n                  '--font-size': '14px',\n                  '--gap': '10px',\n                }}>Pick up face-to-face (If you choose\n                  this option, please talk to seller first.)</Radio>\n                <Radio value='delivery' style={{\n                  '--icon-size': '18px',\n                  '--font-size': '14px',\n                  '--gap': '10px',\n                }}>Delivery</Radio>\n              </Space>\n            </Radio.Group>\n          </div>\n\n          <div>\n            <TextArea defaultValue={'Please type your address'} value={deliveryAddress} onChange={val => setDeliveryAddress(val)} style={{ '--font-size': '10px' }} showCount />\n          </div>\n\n        </div>\n      </div>\n\n    </div>\n\n\n    <div className={styles.bottom}>\n      <div className={styles.form}></div>\n      <Form\n        layout='horizontal'\n        onFinish={(value) => onComfirmedCallback(value)}\n        footer={\n          <Button block type='submit' color='primary' size='large'>\n            Comfirmed Offer\n          </Button>\n        }\n      >\n        <Form.Item\n          label='Asking Price'\n          name='askingPrice'\n          extra={<a>{price}</a>}\n        // rules={[{ required: true, message: 'Asking Price must be required' }]}\n        >\n        </Form.Item>\n        <Form.Item\n          label='Offer Price'\n          name='offerPrice'\n          rules={[{ required: true, message: 'Offer Price must be required' }]}\n        >\n          <Input onChange={console.log} placeholder='Input the offer price' />\n        </Form.Item>\n      </Form>\n\n\n\n\n    </div>\n\n  </div>\n\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}