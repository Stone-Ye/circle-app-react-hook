{"ast":null,"code":"import _defineProperty from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _slicedToArray from \"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { forwardRef, useRef, useState, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useThrottleFn } from 'ahooks';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { Sidebar } from './sidebar';\nimport { convertPx } from '../../utils/convert-px';\nimport { Panel } from './panel';\nimport { devWarning } from '../../utils/dev-log';\nimport { traverseReactNode } from '../../utils/traverse-react-node';\nvar classPrefix = \"adm-index-bar\";\nvar defaultProps = {\n  sticky: true\n};\nexport var IndexBar = forwardRef(function (p, ref) {\n  var props = mergeProps(defaultProps, p);\n  var titleHeight = convertPx(35);\n  var bodyRef = useRef(null);\n  var indexItems = [];\n  var panels = [];\n  traverseReactNode(props.children, function (child) {\n    var _a;\n\n    if (!React.isValidElement(child)) return;\n\n    if (child.type !== Panel) {\n      devWarning('IndexBar', 'The children of `IndexBar` must be `IndexBar.Panel` components.');\n      return;\n    }\n\n    indexItems.push({\n      index: child.props.index,\n      brief: (_a = child.props.brief) !== null && _a !== void 0 ? _a : child.props.index.charAt(0)\n    });\n    panels.push(withNativeProps(child.props, React.createElement(\"div\", {\n      key: child.props.index,\n      \"data-index\": child.props.index,\n      className: \"\".concat(classPrefix, \"-anchor\")\n    }, React.createElement(\"div\", {\n      className: \"\".concat(classPrefix, \"-anchor-title\")\n    }, child.props.title || child.props.index), child.props.children)));\n  });\n\n  var _useState = useState(function () {\n    var firstItem = indexItems[0];\n    return firstItem ? firstItem.index : null;\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      activeIndex = _useState2[0],\n      setActiveIndex = _useState2[1];\n\n  useImperativeHandle(ref, function () {\n    return {\n      scrollTo: scrollTo\n    };\n  });\n\n  function scrollTo(index) {\n    var _a;\n\n    var body = bodyRef.current;\n    if (!body) return;\n    var children = body.children;\n\n    for (var i = 0; i < children.length; i++) {\n      var panel = children.item(i);\n      if (!panel) continue;\n      var panelIndex = panel.dataset['index'];\n\n      if (panelIndex === index) {\n        body.scrollTop = panel.offsetTop;\n        setActiveIndex(index);\n        activeIndex !== index && ((_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, index));\n        return;\n      }\n    }\n  }\n\n  var _useThrottleFn = useThrottleFn(function () {\n    var _a;\n\n    var body = bodyRef.current;\n    if (!body) return;\n    var scrollTop = body.scrollTop;\n    var elements = body.getElementsByClassName(\"\".concat(classPrefix, \"-anchor\"));\n\n    for (var i = 0; i < elements.length; i++) {\n      var panel = elements.item(i);\n      if (!panel) continue;\n      var panelIndex = panel.dataset['index'];\n      if (!panelIndex) continue;\n\n      if (panel.offsetTop + panel.clientHeight - titleHeight > scrollTop) {\n        setActiveIndex(panelIndex);\n        activeIndex !== panelIndex && ((_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, panelIndex));\n        return;\n      }\n    }\n  }, {\n    wait: 50,\n    trailing: true,\n    leading: true\n  }),\n      checkActiveIndex = _useThrottleFn.run;\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(\"\".concat(classPrefix), _defineProperty({}, \"\".concat(classPrefix, \"-sticky\"), props.sticky))\n  }, React.createElement(Sidebar, {\n    indexItems: indexItems,\n    activeIndex: activeIndex,\n    onActive: function onActive(index) {\n      scrollTo(index);\n    }\n  }), React.createElement(\"div\", {\n    className: \"\".concat(classPrefix, \"-body\"),\n    ref: bodyRef,\n    onScroll: checkActiveIndex\n  }, panels)));\n});","map":{"version":3,"names":["React","forwardRef","useRef","useState","useImperativeHandle","classNames","withNativeProps","useThrottleFn","mergeProps","Sidebar","convertPx","Panel","devWarning","traverseReactNode","classPrefix","defaultProps","sticky","IndexBar","p","ref","props","titleHeight","bodyRef","indexItems","panels","children","child","_a","isValidElement","type","push","index","brief","charAt","createElement","key","className","title","firstItem","activeIndex","setActiveIndex","scrollTo","body","current","i","length","panel","item","panelIndex","dataset","scrollTop","offsetTop","onIndexChange","call","elements","getElementsByClassName","clientHeight","wait","trailing","leading","checkActiveIndex","run","onActive","onScroll"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/node_modules/antd-mobile/es/components/index-bar/index-bar.js"],"sourcesContent":["import React, { forwardRef, useRef, useState, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useThrottleFn } from 'ahooks';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { Sidebar } from './sidebar';\nimport { convertPx } from '../../utils/convert-px';\nimport { Panel } from './panel';\nimport { devWarning } from '../../utils/dev-log';\nimport { traverseReactNode } from '../../utils/traverse-react-node';\nconst classPrefix = `adm-index-bar`;\nconst defaultProps = {\n  sticky: true\n};\nexport const IndexBar = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const titleHeight = convertPx(35);\n  const bodyRef = useRef(null);\n  const indexItems = [];\n  const panels = [];\n  traverseReactNode(props.children, child => {\n    var _a;\n\n    if (!React.isValidElement(child)) return;\n\n    if (child.type !== Panel) {\n      devWarning('IndexBar', 'The children of `IndexBar` must be `IndexBar.Panel` components.');\n      return;\n    }\n\n    indexItems.push({\n      index: child.props.index,\n      brief: (_a = child.props.brief) !== null && _a !== void 0 ? _a : child.props.index.charAt(0)\n    });\n    panels.push(withNativeProps(child.props, React.createElement(\"div\", {\n      key: child.props.index,\n      \"data-index\": child.props.index,\n      className: `${classPrefix}-anchor`\n    }, React.createElement(\"div\", {\n      className: `${classPrefix}-anchor-title`\n    }, child.props.title || child.props.index), child.props.children)));\n  });\n  const [activeIndex, setActiveIndex] = useState(() => {\n    const firstItem = indexItems[0];\n    return firstItem ? firstItem.index : null;\n  });\n  useImperativeHandle(ref, () => ({\n    scrollTo\n  }));\n\n  function scrollTo(index) {\n    var _a;\n\n    const body = bodyRef.current;\n    if (!body) return;\n    const children = body.children;\n\n    for (let i = 0; i < children.length; i++) {\n      const panel = children.item(i);\n      if (!panel) continue;\n      const panelIndex = panel.dataset['index'];\n\n      if (panelIndex === index) {\n        body.scrollTop = panel.offsetTop;\n        setActiveIndex(index);\n        activeIndex !== index && ((_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, index));\n        return;\n      }\n    }\n  }\n\n  const {\n    run: checkActiveIndex\n  } = useThrottleFn(() => {\n    var _a;\n\n    const body = bodyRef.current;\n    if (!body) return;\n    const scrollTop = body.scrollTop;\n    const elements = body.getElementsByClassName(`${classPrefix}-anchor`);\n\n    for (let i = 0; i < elements.length; i++) {\n      const panel = elements.item(i);\n      if (!panel) continue;\n      const panelIndex = panel.dataset['index'];\n      if (!panelIndex) continue;\n\n      if (panel.offsetTop + panel.clientHeight - titleHeight > scrollTop) {\n        setActiveIndex(panelIndex);\n        activeIndex !== panelIndex && ((_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, panelIndex));\n        return;\n      }\n    }\n  }, {\n    wait: 50,\n    trailing: true,\n    leading: true\n  });\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(`${classPrefix}`, {\n      [`${classPrefix}-sticky`]: props.sticky\n    })\n  }, React.createElement(Sidebar, {\n    indexItems: indexItems,\n    activeIndex: activeIndex,\n    onActive: index => {\n      scrollTo(index);\n    }\n  }), React.createElement(\"div\", {\n    className: `${classPrefix}-body`,\n    ref: bodyRef,\n    onScroll: checkActiveIndex\n  }, panels)));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}