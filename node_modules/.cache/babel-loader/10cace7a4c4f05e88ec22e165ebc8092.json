{"ast":null,"code":"import _toConsumableArray from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _defineProperty from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _slicedToArray from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useRef,useState,useEffect}from'react';import{Form,Input,Button,TextArea,SideBar,ImageUploader,Dropdown,Toast}from'antd-mobile';import{useNavigate}from'react-router-dom';import{getCategorysData,getProductsData,updateProductsData,getUserName,getAllUserInfos,updateAllUserInfos}from'../Utils/global';import styles from'./index.module.css';import{UploadImg}from'../Utils/uploadImg';import HeadNav from'../Component/HeadNav';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Post(){var navigate=useNavigate();var ref=useRef(null);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),categorysData=_useState2[0],setCategorysData=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isShowSelectCategory=_useState4[0],setIsShowSelectCategory=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),curActiveIndex=_useState6[0],setCurActiveIndex=_useState6[1];useEffect(function(){setCategorysData(getCategorysData());},[]);var submitCallback=function submitCallback(values){var _formdataDict;console.log('Todo form values: ',values);var formdataDict=(_formdataDict={'productId':''},_defineProperty(_formdataDict,\"productId\",''),_defineProperty(_formdataDict,'imgs',[]),_defineProperty(_formdataDict,'title',''),_defineProperty(_formdataDict,'price',''),_defineProperty(_formdataDict,'desc',''),_defineProperty(_formdataDict,'seller',''),_defineProperty(_formdataDict,'viewCount',0),_formdataDict);var productsData=getProductsData();var curUserName=getUserName();var allUserInfos=getAllUserInfos();var newProductId=productsData.length;formdataDict.productId=newProductId;formdataDict.category=categorysData[curActiveIndex-1].title;formdataDict.price=values.price;formdataDict.desc=values.desc;formdataDict.imgs=values.img.map(function(value){return value.url;});formdataDict.title=values.name;formdataDict.seller=curUserName;allUserInfos[curUserName]['postList'].push(newProductId);updateProductsData([].concat(_toConsumableArray(productsData),[formdataDict]));updateAllUserInfos(allUserInfos);Toast.show({content:'Post product is successful',afterClose:function afterClose(){navigate('/home',{replace:true});}});};var onChangeCallback=function onChangeCallback(ref,index){var _ref$current;console.log('onChangeCallback index:',index);setCurActiveIndex(index);setIsShowSelectCategory(false);(_ref$current=ref.current)===null||_ref$current===void 0?void 0:_ref$current.close();};return/*#__PURE__*/_jsxs(\"div\",{className:styles.containerPost,children:[/*#__PURE__*/_jsx(HeadNav,{title:\"Post\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.bodyForm,children:/*#__PURE__*/_jsxs(Form,{name:\"form\",onFinish:submitCallback,footer:/*#__PURE__*/_jsx(Button,{block:true,type:\"submit\",color:\"primary\",size:\"large\",children:\"\\u63D0\\u4EA4\"}),children:[/*#__PURE__*/_jsx(Form.Item,{name:\"name\",label:\"ProductsName\",rules:[{required:true}],children:/*#__PURE__*/_jsx(Input,{placeholder:\"productsName\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"category\",label:\"Category\",children:/*#__PURE__*/_jsxs(Dropdown,{onChange:function onChange(){return setIsShowSelectCategory(true);},ref:ref,children:[curActiveIndex!=1?categorysData[curActiveIndex-1].title:'Sport & Hobby',/*#__PURE__*/_jsx(Dropdown.Item,{title:\"\",children:isShowSelectCategory?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(SideBar,{activeKey:curActiveIndex,onChange:function onChange(index){return onChangeCallback(ref,index);},children:categorysData.map(function(item){return/*#__PURE__*/_jsx(SideBar.Item,{title:item.title},item.categoryId);})})}):null},'sorter')]})}),/*#__PURE__*/_jsx(Form.Item,{name:\"price\",label:\"Price\",rules:[{required:true}],children:/*#__PURE__*/_jsx(Input,{placeholder:\"price \"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"desc\",label:\"Description\",children:/*#__PURE__*/_jsx(TextArea,{placeholder:\"description \"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"img\",label:\"Upload Images\",rules:[{required:true}],children:/*#__PURE__*/_jsx(ImageUploader,{upload:UploadImg,maxCount:3,multiple:true})})]})})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","Form","Input","Button","TextArea","SideBar","ImageUploader","Dropdown","Toast","useNavigate","getCategorysData","getProductsData","updateProductsData","getUserName","getAllUserInfos","updateAllUserInfos","styles","UploadImg","HeadNav","Post","navigate","ref","categorysData","setCategorysData","isShowSelectCategory","setIsShowSelectCategory","curActiveIndex","setCurActiveIndex","submitCallback","values","console","log","formdataDict","productsData","curUserName","allUserInfos","newProductId","length","productId","category","title","price","desc","imgs","img","map","value","url","name","seller","push","show","content","afterClose","replace","onChangeCallback","index","current","close","containerPost","bodyForm","required","item","categoryId"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/src/views/Post/index.js"],"sourcesContent":["import React, { useRef, useState, useEffect } from 'react'\nimport {\n  Form, Input, Button, TextArea, SideBar, ImageUploader, Dropdown, Toast\n} from 'antd-mobile'\nimport { useNavigate } from 'react-router-dom'\nimport { getCategorysData, getProductsData, updateProductsData, getUserName, getAllUserInfos, updateAllUserInfos } from '../Utils/global'\nimport styles from './index.module.css'\nimport { UploadImg } from '../Utils/uploadImg'\nimport HeadNav from '../Component/HeadNav'\n\n\n\nexport default function Post () {\n\n  const navigate = useNavigate()\n  const ref = useRef(null)\n  const [categorysData, setCategorysData] = useState([])\n  const [isShowSelectCategory, setIsShowSelectCategory] = useState(false)\n  const [curActiveIndex, setCurActiveIndex] = useState(1)\n\n\n\n  useEffect(() => {\n    setCategorysData(getCategorysData())\n  }, [])\n\n  const submitCallback = (values) => {\n    console.log('Todo form values: ', values)\n    let formdataDict = {\n      'productId': '', 'productId': '', 'imgs': [], 'title': '', 'price': '', 'desc': '', 'seller': '', 'viewCount': 0\n    }\n\n    let productsData = getProductsData()\n    let curUserName = getUserName()\n    let allUserInfos = getAllUserInfos()\n    let newProductId = productsData.length\n\n\n    formdataDict.productId = newProductId\n    formdataDict.category = categorysData[curActiveIndex - 1].title\n    formdataDict.price = values.price\n    formdataDict.desc = values.desc\n    formdataDict.imgs = values.img.map((value) => value.url)\n    formdataDict.title = values.name\n    formdataDict.seller = curUserName\n\n\n    allUserInfos[curUserName]['postList'].push(newProductId)\n    updateProductsData([...productsData, formdataDict])\n    updateAllUserInfos(allUserInfos)\n    Toast.show({\n      content: 'Post product is successful',\n      afterClose: () => {\n        navigate('/home', { replace: true })\n      },\n    })\n\n\n\n  }\n\n\n  const onChangeCallback = (ref, index) => {\n    console.log('onChangeCallback index:', index)\n    setCurActiveIndex(index)\n    setIsShowSelectCategory(false)\n    ref.current?.close()\n  }\n\n  return <div className={styles.containerPost}>\n    <HeadNav title='Post' />\n\n    <div className={styles.bodyForm}>\n      <Form\n        name='form'\n        onFinish={submitCallback}\n        footer={\n          <Button block type='submit' color='primary' size='large'>\n            提交\n          </Button>\n        }\n      >\n        <Form.Item name='name' label='ProductsName' rules={[{ required: true }]}>\n          <Input placeholder='productsName' />\n        </Form.Item>\n\n        <Form.Item name='category' label='Category' >\n          <Dropdown onChange={() => setIsShowSelectCategory(true)} ref={ref}>\n            {curActiveIndex != 1 ? categorysData[curActiveIndex - 1].title : 'Sport & Hobby'}\n            <Dropdown.Item key='sorter' title='' >\n              {isShowSelectCategory ? <div >\n                <SideBar activeKey={curActiveIndex} onChange={(index) => onChangeCallback(ref, index)}>\n                  {categorysData.map(item => (\n                    <SideBar.Item key={item.categoryId}\n                      title={item.title}\n                    />\n                  ))}\n                </SideBar>\n              </div> : null}\n            </Dropdown.Item>\n          </Dropdown>\n\n        </Form.Item>\n\n        <Form.Item name='price' label='Price' rules={[{ required: true }]}>\n          <Input placeholder='price ' />\n        </Form.Item>\n\n        <Form.Item name='desc' label='Description' >\n          <TextArea placeholder='description ' />\n        </Form.Item>\n\n        <Form.Item name='img' label='Upload Images' rules={[{ required: true }]}>\n          <ImageUploader\n            upload={UploadImg}\n            maxCount={3}\n            multiple={true}\n          />\n        </Form.Item>\n\n      </Form>\n    </div>\n\n  </div >\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}