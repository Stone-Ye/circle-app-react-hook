{"ast":null,"code":"import _objectSpread from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/stoneye/react_project/circle-app-react-hook/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{Grid,CapsuleTabs,Space,Radio}from'antd-mobile';import styles from'./index.module.css';import{getProductsData,getUserName,getAllUserInfos,getCurrentUserInfos,updateAllUserInfos}from'../Utils/global';import{getCurrentTime}from'../Utils/time';import HeadNav from'../Component/HeadNav';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function OfferHistory(){var navigate=useNavigate();var _useState=useState('1'),_useState2=_slicedToArray(_useState,2),curActiveIndex=_useState2[0],setCurActiveIndex=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),curUserInfos=_useState4[0],setCurUserInfos=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),allProductInfos=_useState6[0],setAllProductInfos=_useState6[1];var tarbars=[{id:1,title:'My Offers'},{id:2,title:'Waitting List'},{id:3,title:'My Orders'}];useEffect(function(){setCurUserInfos(getCurrentUserInfos());setAllProductInfos(getProductsData());},[]);var Middle=function Middle(_ref){var curUserInfos=_ref.curUserInfos,curActiveIndex=_ref.curActiveIndex;console.log('curUserInfos: ',curUserInfos);var userDatas=[];switch(Number(curActiveIndex)){case 1:userDatas=curUserInfos.offers?curUserInfos.offers:[];break;case 2:userDatas=curUserInfos['orders']?curUserInfos['orders']:[];userDatas=userDatas.filter(function(item){return item.status==0;});break;case 3:userDatas=curUserInfos.orders?curUserInfos.orders:[];// 根据status状态过滤，status:0:待处理,1:拒绝,2：接受\nbreak;default:break;}userDatas=userDatas.filter(function(item){return item.isValid==1;});var statusInfos={0:'Waiting',1:'Agree',2:'Reject'};var waitingListsStatusChangeCallback=function waitingListsStatusChangeCallback(value,offerId,buyer,productId,index){console.log(\"waitingListsStatusChangeCallback: \",value,productId,index);var newCurUserInfos=_objectSpread({},curUserInfos);var curUername=getUserName();var allUserInfos=getAllUserInfos();newCurUserInfos['orders'][index].status=Number(value);allUserInfos[curUername]=newCurUserInfos;allUserInfos[buyer]['offers'][offerId].stepInfos={'status':Number(value),'time':getCurrentTime()};updateAllUserInfos(allUserInfos);setCurUserInfos(newCurUserInfos);};return userDatas==[]?'':/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Grid,{columns:1,children:userDatas.map(function(item,index){var _allProductInfos$item=allProductInfos[item.productId],imgs=_allProductInfos$item.imgs,title=_allProductInfos$item.title,price=_allProductInfos$item.price,seller=_allProductInfos$item.seller;console.log('index: ',index);console.log('item: ',item);return/*#__PURE__*/_jsx(Grid.Item,{onClick:function onClick(){if(curActiveIndex==1){navigate('/checkyouroffer',{replace:true,state:{'productInfos':allProductInfos[item.productId],'offerDetails':item}});}},children:/*#__PURE__*/_jsxs(\"div\",{className:styles.ItemContent,children:[/*#__PURE__*/_jsxs(\"div\",{children:[curActiveIndex==1?/*#__PURE__*/_jsxs(\"p\",{children:[\"Seller: \",seller]}):/*#__PURE__*/_jsxs(\"p\",{children:[\"Buyer: \",item['buyer'],\" \"]}),/*#__PURE__*/_jsx(\"p\",{children:item['time']})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.ItemContentLeft,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:imgs[0],width:\"100px\",height:\"100px\"})}),curActiveIndex==1?/*#__PURE__*/_jsxs(\"div\",{children:[\"Status: \",statusInfos[item.stepInfos.status],\" \"]}):curActiveIndex==2?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Radio.Group,{onChange:function onChange(value){return waitingListsStatusChangeCallback(value,item.offerId,item.buyer,item.productId,item.itemId);},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Radio,{value:\"1\",style:{'--icon-size':'16px','--font-size':'12px','--gap':'6px'},children:\"Agree\"}),/*#__PURE__*/_jsx(Radio,{value:\"2\",style:{'--icon-size':'16px','--font-size':'12px','--gap':'6px'},children:\"Reject\"})]})})}):curActiveIndex==3?/*#__PURE__*/_jsxs(\"div\",{children:[\"State: \",statusInfos[item.status]]}):'']}),/*#__PURE__*/_jsxs(\"div\",{className:styles.ItemContentRight,children:[/*#__PURE__*/_jsx(\"p\",{children:title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Asking price:   \",price]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Offer price:   \",item['offerPrice']]})]})]})]})},'iteminfos'+index);})})});};if(allProductInfos=={})return/*#__PURE__*/_jsx(_Fragment,{});return/*#__PURE__*/_jsxs(\"div\",{className:styles.container,children:[/*#__PURE__*/_jsx(HeadNav,{title:\"Offer History\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.body,children:/*#__PURE__*/_jsx(CapsuleTabs,{activeKey:curActiveIndex,onChange:function onChange(index){return setCurActiveIndex(index);},children:tarbars.map(function(item){return/*#__PURE__*/_jsx(CapsuleTabs.Tab,{title:item.title,children:/*#__PURE__*/_jsx(Middle,{curUserInfos:curUserInfos,curActiveIndex:curActiveIndex},'middle'+item.id)},item.id.toString());})})})]});}","map":{"version":3,"names":["React","useEffect","useState","useNavigate","Grid","CapsuleTabs","Space","Radio","styles","getProductsData","getUserName","getAllUserInfos","getCurrentUserInfos","updateAllUserInfos","getCurrentTime","HeadNav","OfferHistory","navigate","curActiveIndex","setCurActiveIndex","curUserInfos","setCurUserInfos","allProductInfos","setAllProductInfos","tarbars","id","title","Middle","console","log","userDatas","Number","offers","filter","item","status","orders","isValid","statusInfos","waitingListsStatusChangeCallback","value","offerId","buyer","productId","index","newCurUserInfos","curUername","allUserInfos","stepInfos","map","imgs","price","seller","replace","state","ItemContent","ItemContentLeft","itemId","ItemContentRight","container","body","toString"],"sources":["/Users/stoneye/react_project/circle-app-react-hook/src/views/OfferHistory/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { Grid, CapsuleTabs, Space, Radio } from 'antd-mobile'\nimport styles from './index.module.css'\nimport {\n  getProductsData, getUserName, getAllUserInfos, getCurrentUserInfos, updateAllUserInfos\n} from '../Utils/global'\nimport { getCurrentTime } from '../Utils/time'\nimport HeadNav from '../Component/HeadNav'\n\n\nexport default function OfferHistory () {\n\n  const navigate = useNavigate()\n  const [curActiveIndex, setCurActiveIndex] = useState('1')\n  const [curUserInfos, setCurUserInfos] = useState({})\n  const [allProductInfos, setAllProductInfos] = useState({})\n  const tarbars = [{ id: 1, title: 'My Offers' }, { id: 2, title: 'Waitting List' }, { id: 3, title: 'My Orders' }]\n\n\n  useEffect(() => {\n    setCurUserInfos(getCurrentUserInfos())\n    setAllProductInfos(getProductsData())\n  }, [])\n\n\n  const Middle = ({ curUserInfos, curActiveIndex }) => {\n\n    console.log('curUserInfos: ', curUserInfos)\n\n    let userDatas = []\n    switch (Number(curActiveIndex)) {\n      case 1:\n        userDatas = curUserInfos.offers ? curUserInfos.offers : []\n        break\n      case 2:\n        userDatas = curUserInfos['orders'] ? curUserInfos['orders'] : []\n        userDatas = userDatas.filter((item) => item.status == 0)\n        break\n\n      case 3:\n        userDatas = curUserInfos.orders ? curUserInfos.orders : []\n        // 根据status状态过滤，status:0:待处理,1:拒绝,2：接受\n\n        break\n\n      default:\n        break\n    }\n\n    userDatas = userDatas.filter((item) => item.isValid == 1)\n\n\n    let statusInfos = { 0: 'Waiting', 1: 'Agree', 2: 'Reject' }\n\n    const waitingListsStatusChangeCallback = (value, offerId, buyer, productId, index) => {\n      console.log(\"waitingListsStatusChangeCallback: \", value, productId, index)\n\n      let newCurUserInfos = { ...curUserInfos }\n      let curUername = getUserName()\n\n      let allUserInfos = getAllUserInfos()\n      newCurUserInfos['orders'][index].status = Number(value)\n      allUserInfos[curUername] = newCurUserInfos\n\n      allUserInfos[buyer]['offers'][offerId].stepInfos = { 'status': Number(value), 'time': getCurrentTime() }\n\n      updateAllUserInfos(allUserInfos)\n      setCurUserInfos(newCurUserInfos)\n    }\n\n    return userDatas == [] ? '' : <div>\n      <Grid columns={1} >\n        {userDatas.map((item, index) => {\n\n          let { imgs, title, price, seller } = allProductInfos[item.productId]\n          console.log('index: ', index)\n          console.log('item: ', item)\n\n          return <Grid.Item key={'iteminfos' + index} onClick={() => {\n            if (curActiveIndex == 1) {\n              navigate('/checkyouroffer', { replace: true, state: { 'productInfos': allProductInfos[item.productId], 'offerDetails': item } })\n            }\n          }\n          }>\n            <div className={styles.ItemContent} >\n              <div>\n                {curActiveIndex == 1 ? <p>Seller: {seller}</p> : <p>Buyer: {item['buyer']} </p>}\n\n                <p>{item['time']}</p>\n              </div>\n\n              <div>\n                <div className={styles.ItemContentLeft}>\n                  <div><img src={imgs[0]} width='100px' height='100px' /></div>\n                  {curActiveIndex == 1 ? <div>Status: {statusInfos[item.stepInfos.status]} </div> :\n                    curActiveIndex == 2 ? <div>\n                      <Radio.Group onChange={(value) => waitingListsStatusChangeCallback(value, item.offerId, item.buyer, item.productId, item.itemId)}>\n                        <Space >\n                          <Radio value='1' style={{\n                            '--icon-size': '16px',\n                            '--font-size': '12px',\n                            '--gap': '6px',\n                          }}>Agree</Radio>\n                          <Radio value='2' style={{\n                            '--icon-size': '16px',\n                            '--font-size': '12px',\n                            '--gap': '6px',\n                          }}>Reject</Radio>\n                        </Space>\n                      </Radio.Group>\n                    </div> : curActiveIndex == 3 ? <div>\n                      State: {statusInfos[item.status]}\n                    </div> : ''}\n\n                </div>\n\n                <div className={styles.ItemContentRight}>\n                  <p>{title}</p>\n                  <p>Asking price:   {price}</p>\n                  <p>Offer price:   {item['offerPrice']}</p>\n\n                </div>\n\n              </div>\n\n            </div>\n          </Grid.Item>\n        }\n        )}\n      </Grid>\n    </div >\n\n  }\n\n\n\n  if (allProductInfos == {}) return <></>\n\n\n\n  return <div className={styles.container}>\n    <HeadNav title='Offer History' />\n    <div className={styles.body}>\n      <CapsuleTabs activeKey={curActiveIndex} onChange={(index) => setCurActiveIndex(index)} >\n        {\n          tarbars.map((item) => {\n            return <CapsuleTabs.Tab title={item.title} key={item.id.toString()}>\n              <Middle\n                key={'middle' + item.id}\n                curUserInfos={curUserInfos}\n                curActiveIndex={curActiveIndex} />\n            </CapsuleTabs.Tab>\n          }\n          )\n        }\n      </CapsuleTabs>\n    </div>\n  </div >\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}